# SovereignCore Redis Production Configuration
# Based on Redis 6+ best practices

# Network Security
# ================
# Bind to localhost only (change for production deployment)
bind 127.0.0.1 ::1

# Protected mode - prevents external access
protected-mode yes

# Port
port 6379

# TLS/SSL Configuration (uncomment for production)
# tls-port 6380
# port 0  # Disable non-TLS port
# tls-cert-file /path/to/redis.crt
# tls-key-file /path/to/redis.key
# tls-ca-cert-file /path/to/ca.crt
# tls-auth-clients no  # Set to 'yes' for mutual TLS

# Authentication
# ==============
# Require password (CHANGE THIS!)
requirepass your-strong-redis-password-here-change-this

# ACL Configuration (Redis 6+)
# ============================
# Load ACL rules from file
aclfile /usr/local/etc/redis/users.acl

# Disable dangerous commands
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG "CONFIG_ADMIN_ONLY"
rename-command SHUTDOWN "SHUTDOWN_ADMIN_ONLY"
rename-command BGREWRITEAOF "BGREWRITEAOF_ADMIN_ONLY"
rename-command BGSAVE "BGSAVE_ADMIN_ONLY"
rename-command SAVE "SAVE_ADMIN_ONLY"
rename-command DEBUG "DEBUG_ADMIN_ONLY"

# Persistence
# ===========
# RDB Snapshots
save 900 1      # Save if 1 key changed in 900 seconds
save 300 10     # Save if 10 keys changed in 300 seconds
save 60 10000   # Save if 10000 keys changed in 60 seconds

stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir /var/lib/redis

# AOF (Append Only File) - More durable than RDB
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec  # Balance between performance and durability
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# Memory Management
# =================
# Maximum memory (adjust based on your system)
maxmemory 2gb

# Eviction policy when maxmemory is reached
maxmemory-policy allkeys-lru

# Performance
# ===========
# Max clients
maxclients 10000

# Timeout for idle clients (0 = disabled)
timeout 300

# TCP keepalive
tcp-keepalive 300

# TCP backlog
tcp-backlog 511

# Logging
# =======
loglevel notice
logfile /var/log/redis/redis-server.log

# Slow log configuration
slowlog-log-slower-than 10000  # 10ms
slowlog-max-len 128

# Advanced
# ========
# Disable transparent huge pages warning
always-show-logo no

# Latency monitoring
latency-monitor-threshold 100

# Notify keyspace events (disabled by default for performance)
# notify-keyspace-events ""

# Client output buffer limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Replication (if using Redis replicas)
# replica-read-only yes
# repl-diskless-sync no
# repl-diskless-sync-delay 5

# Security hardening
# ==================
# Disable Lua scripting if not needed (uncomment to disable)
# rename-command EVAL ""
# rename-command EVALSHA ""

# Disable module loading if not needed
# enable-module-command no
